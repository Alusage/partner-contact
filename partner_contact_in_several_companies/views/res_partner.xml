<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_res_partner_filter_contact" model="ir.ui.view">
        <field name="name">res.partner.select.contact</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_res_partner_filter"/>
        <field name="arch" type="xml">
            <filter name="type_company" position="after">
                <separator/>
                <filter context="{'search_show_all_positions': {'is_set': True, 'set_value': True}}" help="All partner positions" name="type_otherpositions" string="All positions"/>
            </filter>
            <xpath expr="/search/group[@name='group_by']" position="inside">
                <filter context="{'group_by': 'contact_id'}" name="group_person" string="Person"/>
            </xpath></field>
    </record>
    <record id="view_res_partner_tree_contact" model="ir.ui.view">
        <field name="name">res.partner.tree.contact</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_tree"/>
        <field name="arch" type="xml">
            <field name="parent_id" position="after">
                <field invisible="1" name="contact_id"/></field></field>
    </record>
    <record id="view_partner_form_inherit" model="ir.ui.view">
        <field name="name">res.partner.form.contact</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <field name="parent_id" position="after">
                <field invisible="1" name="contact_id"/></field>
            <xpath expr="//field[@name='child_ids']/form//field[@name='name']" position="before">
                <field name="contact_type" readonly="0"/>
                <field invisible="contact_type != 'attached'" name="contact_id" required="contact_type == 'attached'" string="Contact"/>
            </xpath>
            <xpath expr="//field[@name='child_ids']/form//field[@name='name']" position="attributes">
                <attribute name="invisible">contact_type == 'attached'</attribute>
            </xpath>
            <field name="is_company" position="after">
                <field invisible="1" name="contact_type"/></field>
            <page name="internal_notes" position="before">
                <page invisible="is_company == True or contact_id != False" name="other_position" string="Other Positions">
                    <field context="{'default_contact_id': active_id, 'default_name': name, 'default_street': street, 'default_street2': street2, 'default_city': city, 'default_state_id': state_id, 'default_zip': zip, 'default_country_id': country_id}" mode="kanban" name="other_contact_ids">
                        <kanban create="false">
                            <field name="color"/>
                            <field name="name"/>
                            <field name="title"/>
                            <field name="email"/>
                            <field name="parent_id"/>
                            <field name="is_company"/>
                            <field name="function"/>
                            <field name="phone"/>
                            <field name="street"/>
                            <field name="street2"/>
                            <field name="zip"/>
                            <field name="city"/>
                            <field name="country_id"/>
                            <field name="mobile"/>
                            <field name="state_id"/>
                            <field name="image_128"/>
                            <field name="lang"/>
                            <templates>
                                <t t-name="kanban-box">
                                    <t t-set="color" t-value="kanban_color(record.color.raw_value)"/>
                                    <div t-att-class="color + (record.title.raw_value == 1 ? ' oe_kanban_color_alert' : '') + ' oe_kanban_global_click'">
                                        <a class="fa fa-times float-end" title="Delete Contact" type="delete"/>
                                        <div class="o_kanban_image">
                                            <img alt="Contact image" t-att-src="kanban_image('res.partner', 'avatar_128', record.id.raw_value)"/>
                                        </div>
                                        <div class="oe_kanban_details">
                                            <field name="name"/>
                                            <div t-if="record.function.raw_value">
                                                <field name="function"/>
                                                at
                                                <field name="parent_id"/>
                                            </div>
                                            <div t-if="record.email.raw_value">
                                                <field name="email"/>
                                            </div>
                                            <div t-if="record.phone.raw_value">
                                                Phone:
                                                <field name="phone"/>
                                            </div>
                                            <div t-if="record.mobile.raw_value">
                                                Mobile:
                                                <field name="mobile"/>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                            </templates>
                        </kanban>
                        <form string="Contact">
                            <sheet>
                                <field name="type" options="{'horizontal': true}" required="1" widget="radio"/>
                                <hr/>
                                <group>
                                    <group invisible="type == 'contact'">
                                        <label for="street" string="Address"/>
                                        <div>
                                            <div class="o_address_format" name="div_address">
                                                <field class="o_address_street" name="street" placeholder="Street..."/>
                                                <field class="o_address_street" name="street2" placeholder="Street 2..."/>
                                                <field class="o_address_city" name="city" placeholder="City"/>
                                                <field class="o_address_state" context="{'country_id': country_id, 'zip': zip}" name="state_id" options='{"no_open": True}' placeholder="State"/>
                                                <field class="o_address_zip" name="zip" placeholder="ZIP"/>
                                                <field class="o_address_country" name="country_id" options='{"no_open": True, "no_create": True}' placeholder="Country"/>
                                            </div>
                                        </div>
                                    </group>
                                    <group>
                                        <field name="name" required="type == 'contact'" string="Contact Name"/>
                                        <field invisible="type != 'contact'" name="title" placeholder="e.g. Mr."/>
                                        <field invisible="type != 'contact'" name="function" placeholder="e.g. Sales Director"/>
                                        <field name="email"/>
                                        <field name="phone" widget="phone"/>
                                        <field name="mobile" widget="phone"/>
                                        <field name="comment" placeholder="internal note..."/>
                                    </group>
                                </group>
                                <field invisible="True" name="lang"/>
                            </sheet>
                        </form></field>
                </page>
            </page></field>
    </record>
    <record id="personal_contact_information" model="ir.ui.view">
        <field name="name">Contacts in several partners: personal info</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="partner_contact_personal_information_page.personal_information"/>
        <field name="arch" type="xml">
            <xpath expr="//page[@name='personal_information_page']/group[@name='personal_information_group']" position="attributes">
                <attribute name="invisible">contact_id != False</attribute>
            </xpath>
            <xpath expr="//page[@name='personal_information_page']/group[@name='personal_information_group']" position="after">
                <p invisible="contact_id == False">
                    To see personal information about this contact, please
                    go to to the this person form:
                    <field class="oe_inline" context="{'show_address': 1}" domain="[('contact_type','!=','attached')]" name="contact_id" options="{'always_reload': True}"/>
                </p>
            </xpath></field>
    </record>
    <record id="view_res_partner_kanban_contact" model="ir.ui.view">
        <field name="name">res.partner.kanban.contact</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.res_partner_kanban_view"/>
        <field name="arch" type="xml">
            <field name="is_company" position="after">
                <field name="other_contact_ids"><tree>
                        <field name="parent_id"/>
                        <field name="function"/>
                    </tree></field></field>
            <xpath expr="//t[@t-name='kanban-box']//div[hasclass('oe_kanban_details')]//ul/li[3]" position="after">
                <t t-if="record.other_contact_ids.raw_value.length > 0">
                    <li>
                        +
                        <t t-esc="record.other_contact_ids.raw_value.length"/>
                        <t t-if="record.other_contact_ids.raw_value.length == 1">
                            other position
                        </t>
                        <t t-if="record.other_contact_ids.raw_value.length > 1">
                            other positions
                        </t>
                    </li>
                </t>
            </xpath></field>
    </record>
</odoo>
